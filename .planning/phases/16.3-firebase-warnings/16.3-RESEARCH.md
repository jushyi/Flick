# Phase 16.3: Fix React Native Firebase Warnings - Research

**Researched:** 2026-01-21
**Domain:** React Native Firebase SDK migration (v22/v23 modular API)
**Confidence:** HIGH

<research_summary>
## Summary

Researched the React Native Firebase SDK warnings and migration requirements for the Lapse Clone project. The project uses `@react-native-firebase/*` packages at version `^23.8.2`, which is current and already supports the modular API.

**Key findings:**
1. The codebase is **95% already migrated** to modular API - only `App.js` uses the deprecated namespaced pattern (`auth().currentUser`)
2. One file (`friendshipService.js`) has an unused default import that should be removed
3. The package.json exports warning has already been patched via `patch-package`
4. No metro.config.js customization is needed since the patch handles the exports issue

**Primary recommendation:** Fix the 2 remaining deprecated API usages in App.js, remove unused import from friendshipService.js, and optionally silence deprecation warnings during transition. This is a 15-minute fix, not a major migration.
</research_summary>

<standard_stack>
## Standard Stack

### Core
| Library | Version | Purpose | Why Standard |
|---------|---------|---------|--------------|
| @react-native-firebase/app | ^23.8.2 | Firebase core initialization | Required base package for all RN Firebase |
| @react-native-firebase/auth | ^23.8.2 | Phone/email authentication | Official RN Firebase auth module |
| @react-native-firebase/firestore | ^23.8.2 | Cloud Firestore database | Official RN Firebase Firestore module |
| @react-native-firebase/storage | ^23.8.2 | Cloud Storage for images | Official RN Firebase Storage module |

### Supporting
| Library | Version | Purpose | When to Use |
|---------|---------|---------|-------------|
| patch-package | ^8.0.1 | Fix package.json exports | Already in use, patches RN Firebase |
| expo-build-properties | ~1.0.10 | iOS build configuration | Configure useFrameworks: static |

### Alternatives Considered
| Instead of | Could Use | Tradeoff |
|------------|-----------|----------|
| @react-native-firebase | Firebase JS SDK | JS SDK works in Expo Go but lacks native features (push notifications, crashlytics) |
| Modular API | Namespaced API | Namespaced deprecated in v22, will be removed in future |

**Installation:**
Already installed. No changes needed to package.json.
</standard_stack>

<architecture_patterns>
## Architecture Patterns

### Recommended Import Pattern (Modular API)

**Auth:**
```typescript
// CORRECT: Modular API
import { getAuth } from '@react-native-firebase/auth';
const auth = getAuth();
const currentUser = auth.currentUser;

// DEPRECATED: Namespaced API (do not use)
import auth from '@react-native-firebase/auth';
auth().currentUser;  // <-- This triggers deprecation warning
```

**Firestore:**
```typescript
// CORRECT: Modular API (already used in codebase)
import { getFirestore, collection, doc, getDoc, getDocs, setDoc, updateDoc, deleteDoc, query, where, orderBy, onSnapshot, serverTimestamp } from '@react-native-firebase/firestore';

const db = getFirestore();
const userRef = doc(db, 'users', userId);
const userDoc = await getDoc(userRef);
```

**Storage:**
```typescript
// CORRECT: Modular API (already used in codebase)
import { getStorage, ref } from '@react-native-firebase/storage';

const storage = getStorage();
const storageRef = ref(storage, `photos/${userId}/${photoId}.jpg`);
await storageRef.putFile(localPath);
const url = await storageRef.getDownloadURL();
```

### Anti-Patterns to Avoid
- **Default imports from Firebase modules:** `import auth from '@react-native-firebase/auth'` - use named imports
- **Calling module as function:** `auth()`, `firestore()`, `storage()` - use `getAuth()`, `getFirestore()`, `getStorage()`
- **Mixed import patterns:** Don't import both default and named exports (like friendshipService.js currently does)
</architecture_patterns>

<dont_hand_roll>
## Don't Hand-Roll

| Problem | Don't Build | Use Instead | Why |
|---------|-------------|-------------|-----|
| Silencing deprecation warnings | Manual console filtering | `globalThis.RNFB_SILENCE_MODULAR_DEPRECATION_WARNINGS = true` | Official supported flag |
| Finding deprecated code | Manual search | `globalThis.RNFB_MODULAR_DEPRECATION_STRICT_MODE = true` | Throws errors on deprecated usage |
| Package.json exports fix | Manual file editing | patch-package with .patch file | Already implemented, survives npm install |

**Key insight:** The migration is mechanical and well-documented. React Native Firebase provides built-in flags to help identify and silence deprecated code during transition.
</dont_hand_roll>

<common_pitfalls>
## Common Pitfalls

### Pitfall 1: Version Mismatch Between Packages
**What goes wrong:** Module resolution errors like "Unable to resolve @react-native-firebase/app/lib/internal/nativeModule"
**Why it happens:** Different major versions of @react-native-firebase packages expect different internal APIs
**How to avoid:** Always keep all @react-native-firebase/* packages at the same version (currently ^23.8.2)
**Warning signs:** Build errors mentioning internal/nativeModule or lib/internal paths

### Pitfall 2: Forgetting to Initialize Module
**What goes wrong:** "getFirestore()" returns undefined or throws error
**Why it happens:** Firebase app not initialized before calling service getters
**How to avoid:** The @react-native-firebase/app plugin auto-initializes. Just import and use modular functions.
**Warning signs:** "No Firebase App '[DEFAULT]' has been created"

### Pitfall 3: Mixing Import Patterns
**What goes wrong:** Deprecation warnings continue even after "migrating"
**Why it happens:** Some files import default export alongside named exports
**How to avoid:** Remove all default imports, use only named modular imports
**Warning signs:** friendshipService.js pattern: `import firestore, { getFirestore, ... }`

### Pitfall 4: Metro Package Exports Resolution
**What goes wrong:** Metro bundler can't find Firebase modules, build fails
**Why it happens:** Metro 0.82+ (Expo SDK 53+) enables package exports by default, conflicts with RN Firebase CommonJS
**How to avoid:** Either use patch-package (already done) or set `unstable_enablePackageExports: false` in metro.config.js
**Warning signs:** "Package subpath './lib/internal/nativeModule' is not defined by 'exports'"
</common_pitfalls>

<code_examples>
## Code Examples

### Current Problem: App.js Namespaced Auth (NEEDS FIXING)
```typescript
// CURRENT (App.js lines 7, 57, 139):
import auth from '@react-native-firebase/auth';
// ...
const currentUser = auth().currentUser;
```

### Solution: Migrate to Modular Auth
```typescript
// FIXED:
import { getAuth } from '@react-native-firebase/auth';
// ...
const auth = getAuth();
const currentUser = auth.currentUser;
```

### Current Problem: Unused Default Import (NEEDS FIXING)
```typescript
// CURRENT (friendshipService.js line 1):
import firestore, { getFirestore, collection, doc, ... } from '@react-native-firebase/firestore';
// 'firestore' is never used
```

### Solution: Remove Unused Default Import
```typescript
// FIXED:
import { getFirestore, collection, doc, ... } from '@react-native-firebase/firestore';
```

### Optional: Silence Deprecation Warnings During Transition
```typescript
// Add to App.js BEFORE any Firebase imports:
globalThis.RNFB_SILENCE_MODULAR_DEPRECATION_WARNINGS = true;

// OR to find remaining deprecated usage:
globalThis.RNFB_MODULAR_DEPRECATION_STRICT_MODE = true;
```

### Existing Correct Pattern (Reference)
```typescript
// Source: src/context/AuthContext.js - already correct
import { getAuth, onAuthStateChanged as firebaseOnAuthStateChanged } from '@react-native-firebase/auth';
import { getFirestore, doc, getDoc, setDoc, updateDoc, serverTimestamp } from '@react-native-firebase/firestore';

const db = getFirestore();
const auth = getAuth();

// Using modular API
const userRef = doc(db, 'users', userId);
const userDoc = await getDoc(userRef);

const unsubscribe = firebaseOnAuthStateChanged(auth, async (firebaseUser) => {
  // Handle auth state change
});
```
</code_examples>

<sota_updates>
## State of the Art (2025-2026)

| Old Approach | Current Approach | When Changed | Impact |
|--------------|------------------|--------------|--------|
| Namespaced API (`auth()`, `firestore()`) | Modular API (`getAuth()`, `getFirestore()`) | v22 (Apr 2025) | Required migration, namespaced deprecated |
| Firebase Dynamic Links | Removed | v23 (Aug 2025) | Service shut down, use Universal Links |
| iOS minDeploymentTarget 13 | iOS 15 minimum | v23 (Aug 2025) | Already using 15.1 in app.json |
| Android minSdk 21 | Android minSdk 23 | v23 (Aug 2025) | Check build.gradle if needed |

**New tools/patterns to consider:**
- **RNFB_SILENCE_MODULAR_DEPRECATION_WARNINGS:** Global flag to suppress warnings during gradual migration
- **RNFB_MODULAR_DEPRECATION_STRICT_MODE:** Throws errors on deprecated usage for faster debugging

**Deprecated/outdated:**
- **Default exports from modules:** `import auth from '@react-native-firebase/auth'` - deprecated
- **Module-as-function pattern:** `auth()`, `firestore()`, `storage()` - deprecated
- **gaMeasurementId:** Renamed to `measurementId` in FirebaseOptions (v23)
</sota_updates>

<open_questions>
## Open Questions

None - this is a well-documented, straightforward migration with clear patterns already established in the codebase.
</open_questions>

<sources>
## Sources

### Primary (HIGH confidence)
- [React Native Firebase - Migrating to v22](https://rnfirebase.io/migrating-to-v22) - Official migration guide
- [React Native Firebase - Migrating to v23](https://rnfirebase.io/migrating-to-v23) - Breaking changes documentation
- [React Native Firebase GitHub](https://github.com/invertase/react-native-firebase) - Issue tracker and changelog

### Secondary (MEDIUM confidence)
- [GitHub Issue #8273](https://github.com/invertase/react-native-firebase/issues/8273) - nativeModule resolution issue
- [GitHub Issue #8334](https://github.com/invertase/react-native-firebase/issues/8334) - Warnings after modular migration (resolved)
- [Expo Discussion #36551](https://github.com/expo/expo/discussions/36551) - Metro ES Module resolution compatibility

### Tertiary (LOW confidence - needs validation)
- None - all findings verified with official sources
</sources>

<metadata>
## Metadata

**Research scope:**
- Core technology: @react-native-firebase SDK v23.8.2
- Ecosystem: Modular API migration from namespaced API
- Patterns: Import patterns, initialization patterns
- Pitfalls: Version mismatches, mixed imports, Metro resolution

**Confidence breakdown:**
- Standard stack: HIGH - current versions verified in package.json
- Architecture: HIGH - patterns already used correctly in 95% of codebase
- Pitfalls: HIGH - documented in official GitHub issues
- Code examples: HIGH - based on actual codebase analysis

**Research date:** 2026-01-21
**Valid until:** 2026-04-21 (90 days - RN Firebase ecosystem stable, v23 is current)
</metadata>

---

*Phase: 16.3-firebase-warnings*
*Research completed: 2026-01-21*
*Ready for planning: yes*

## Migration Scope Summary

**Files Requiring Changes:**

| File | Issue | Effort |
|------|-------|--------|
| App.js | Namespaced auth import + usage (lines 7, 57, 139) | ~5 min |
| src/services/firebase/friendshipService.js | Unused default import (line 1) | ~1 min |

**Files Already Correct:**
- src/context/AuthContext.js
- src/services/firebase/photoService.js
- src/services/firebase/storageService.js
- src/services/firebase/feedService.js
- src/services/firebase/darkroomService.js
- src/services/firebase/phoneAuthService.js
- src/services/firebase/userService.js
- src/services/firebase/notificationService.js
- src/services/uploadQueueService.js
- All screen files using Firebase
- All component files using Firebase

**Package.json Exports Warning:**
Already fixed via patch-package at `patches/@react-native-firebase+app+23.8.2.patch`. No additional action needed.

**Total Estimated Effort:** 10-15 minutes
