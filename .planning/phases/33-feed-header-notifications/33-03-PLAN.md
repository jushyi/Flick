---
phase: 33-feed-header-notifications
plan: 03
type: execute
---

<objective>
Add animated header behavior to feed - header hides on scroll down and reappears on scroll up (Instagram-style).

Purpose: Polish the feed experience with standard mobile UX pattern for maximizing content visibility.
Output: FeedScreen with animated header that responds to scroll direction.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/33-feed-header-notifications/33-CONTEXT.md

@src/screens/FeedScreen.js

**From 33-CONTEXT.md:**

- Header hides on scroll down, returns on scroll up
- Standard Instagram behavior

**Established patterns:**

- Animated values with useRef (SwipeablePhotoCard.js patterns)
- FlatList with onScroll handlers
  </context>

<tasks>

<task type="auto">
  <name>Task 1: Implement scroll-direction tracking</name>
  <files>src/screens/FeedScreen.js</files>
  <action>
Add scroll direction tracking to FeedScreen:

1. **State/refs for scroll tracking:**

   ```javascript
   const scrollY = useRef(new Animated.Value(0)).current;
   const lastScrollY = useRef(0);
   const headerVisible = useRef(new Animated.Value(1)).current; // 1 = visible, 0 = hidden
   const HEADER_HEIGHT = 60; // Approximate header height
   const SCROLL_THRESHOLD = 10; // Min scroll distance to trigger
   ```

2. **Scroll handler function:**

   ```javascript
   const handleScroll = Animated.event([{ nativeEvent: { contentOffset: { y: scrollY } } }], {
     useNativeDriver: false,
     listener: event => {
       const currentY = event.nativeEvent.contentOffset.y;
       const diff = currentY - lastScrollY.current;

       // Only trigger if scrolled past threshold and not at top
       if (Math.abs(diff) > SCROLL_THRESHOLD && currentY > HEADER_HEIGHT) {
         if (diff > 0) {
           // Scrolling down - hide header
           Animated.timing(headerVisible, {
             toValue: 0,
             duration: 200,
             useNativeDriver: true,
           }).start();
         } else {
           // Scrolling up - show header
           Animated.timing(headerVisible, {
             toValue: 1,
             duration: 200,
             useNativeDriver: true,
           }).start();
         }
       }

       // Always show header when near top
       if (currentY < HEADER_HEIGHT) {
         Animated.timing(headerVisible, {
           toValue: 1,
           duration: 200,
           useNativeDriver: true,
         }).start();
       }

       lastScrollY.current = currentY;
     },
   });
   ```

3. **Attach to FlatList:**
   - Add `onScroll={handleScroll}` to FlatList
   - Add `scrollEventThrottle={16}` for smooth tracking
     </action>
     <verify>Add console.log in listener to verify scroll direction detection works</verify>
     <done>Scroll direction tracking implemented with proper threshold handling</done>
     </task>

<task type="auto">
  <name>Task 2: Animate header visibility</name>
  <files>src/screens/FeedScreen.js</files>
  <action>
Apply animation to header View:

1. **Convert header View to Animated.View:**

   ```javascript
   <Animated.View style={[
     styles.header,
     {
       transform: [{
         translateY: headerVisible.interpolate({
           inputRange: [0, 1],
           outputRange: [-HEADER_HEIGHT, 0],
         })
       }],
       opacity: headerVisible, // Optional: fade effect
     }
   ]}>
   ```

2. **Adjust layout for animated header:**
   - Header should be positioned absolutely so content scrolls under it
   - Add paddingTop to FlatList contentContainerStyle equal to HEADER_HEIGHT
   - Update styles.header:
     ```javascript
     header: {
       position: 'absolute',
       top: 0,
       left: 0,
       right: 0,
       zIndex: 10,
       // ... existing styles
     }
     ```

3. **Handle SafeAreaView integration:**
   - If using SafeAreaView edges=['top'], adjust header positioning
   - May need to measure inset and account for it
   - Alternative: Use useSafeAreaInsets() hook for precise control

4. **Stories row consideration:**
   - Stories row should scroll with content (not fixed)
   - Only the header (logo + heart icon) should animate
   - Verify stories row is part of FlatList ListHeaderComponent or above it

5. **Polish:**
   - Ensure header shadow/border doesn't clip during animation
   - Test on both iOS and Android
   - Verify pull-to-refresh still works (header visible when at top)
     </action>
     <verify>
6. Scroll down - header slides up and hides
7. Scroll up - header slides down and reappears
8. At top of list - header always visible
9. Pull-to-refresh works normally
10. Stories row scrolls with content
    </verify>
    <done>Header animates hide/show based on scroll direction, all edge cases handled</done>
    </task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Header hides smoothly when scrolling down
- [ ] Header shows smoothly when scrolling up
- [ ] Header always visible when at top of feed
- [ ] Pull-to-refresh still works correctly
- [ ] Stories row scrolls with content (not fixed)
- [ ] No layout jumps or visual glitches
- [ ] Works on both iOS and Android (if applicable)
- [ ] `npx expo start` - no errors
</verification>

<success_criteria>

- Scroll-direction tracking works with threshold
- Header animates with translateY transform
- Edge case: header visible at top of list
- Edge case: pull-to-refresh works
- Smooth 200ms animation timing
- Phase 33 complete - all 3 plans done
  </success_criteria>

<output>
After completion, create `.planning/phases/33-feed-header-notifications/33-03-SUMMARY.md`
</output>
