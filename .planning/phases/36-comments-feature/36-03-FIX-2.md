---
phase: 36-comments-feature
plan: 03-FIX-2
type: fix
---

<objective>
Fix 6 UAT issues from plan 36-03 Round 3 testing.

Source: 36-03-ISSUES.md
Priority: 0 blocker, 1 major, 5 minor
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md

**Issues being fixed:**
@.planning/phases/36-comments-feature/36-03-ISSUES.md

**Key files:**
@src/components/comments/CommentPreview.js
@src/components/comments/CommentsBottomSheet.js
@src/styles/PhotoDetailModal.styles.js
@src/styles/CommentsBottomSheet.styles.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix UAT-015 & UAT-016 - Comment preview rotation timing and modal-only cleanup</name>
  <files>src/components/comments/CommentPreview.js</files>
  <action>
Two changes to CommentPreview.js:

1. **UAT-015:** Change rotation interval from 4000ms to 2000ms (line 51)
   - Update the setInterval timing to 2000

2. **UAT-016:** Add `showViewAll` prop to control "View all X comments" visibility
   - Add optional `showViewAll` prop, default to `true` for backward compatibility
   - Conditionally render the "View all comments" text only when `showViewAll={true}`
   - FeedPhotoCard will pass `showViewAll={true}` (default)
   - PhotoDetailModal will pass `showViewAll={false}`
     </action>
     <verify>Confirm rotation interval is 2000ms and showViewAll prop exists</verify>
     <done>Rotation every 2 seconds, "View all comments" conditionally shown based on prop</done>
     </task>

<task type="auto">
  <name>Task 2: Update PhotoDetailModal to hide "View all comments"</name>
  <files>src/components/PhotoDetailModal.js</files>
  <action>
Pass `showViewAll={false}` to the CommentPreview component in PhotoDetailModal.

Find where CommentPreview is rendered and add the prop:

```jsx
<CommentPreview
  comments={previewComments}
  totalCount={totalCommentCount}
  onPress={() => setShowComments(true)}
  showViewAll={false}
/>
```

  </action>
  <verify>CommentPreview in modal no longer shows "View all comments" text</verify>
  <done>PhotoDetailModal CommentPreview has showViewAll={false}</done>
</task>

<task type="auto">
  <name>Task 3: Fix UAT-011 - Comment preview alignment with username</name>
  <files>src/styles/PhotoDetailModal.styles.js</files>
  <action>
The comment preview container has `left: 16` but needs to match the exact position of the username.
Looking at the styles:
- `userInfoOverlay` has `left: 16`
- `commentPreviewContainer` has `left: 16`

However, the CommentPreview component has internal padding. The container position is correct but the internal padding in CommentPreview creates offset.

Remove the paddingVertical from CommentPreview container style or ensure the text starts at the exact left edge.

Adjust `commentPreviewContainer` to remove excess padding:

- Change `paddingBottom: 8` to `paddingBottom: 0`
- Ensure the left: 16 aligns with userInfoOverlay left: 16 (both are already 16)

If still misaligned, check CommentPreview.js styles.container for any paddingHorizontal.
</action>
<verify>Comment preview text aligns visually with username text above</verify>
<done>Comment preview left edge aligns with username left edge</done>
</task>

<task type="auto">
  <name>Task 4: Fix UAT-019 - Empty comment preview gap</name>
  <files>src/styles/PhotoDetailModal.styles.js, src/components/PhotoDetailModal.js</files>
  <action>
When no comments exist, the userInfoOverlay is positioned at `bottom: 140` to make room for comment preview.
When there are no comments, this creates excess space.

Fix approach:

1. Make userInfoOverlay position dynamic based on whether comments exist
2. In PhotoDetailModal.js, calculate the bottom position:
   - If previewComments.length > 0: bottom: 140
   - If previewComments.length === 0: bottom: 100 (move closer to footer)

Implementation:

- Keep `userInfoOverlay` style without fixed `bottom` value
- Apply bottom position dynamically in the component via inline style

In PhotoDetailModal.js where userInfoOverlay is used:

```jsx
<View style={[
  styles.userInfoOverlay,
  { bottom: previewComments?.length > 0 ? 140 : 100 }
]}>
```

  </action>
  <verify>When no comments: username appears closer to footer. When comments exist: space for preview</verify>
  <done>Username position adjusts based on presence of preview comments</done>
</task>

<task type="auto">
  <name>Task 5: Fix UAT-018 - Comment input placeholder vertical alignment</name>
  <files>src/components/comments/CommentInput.js</files>
  <action>
The comment input placeholder has uneven vertical padding.

Find the TextInput component in CommentInput.js and adjust:

1. Check the paddingTop/paddingBottom or paddingVertical values
2. Ensure equal padding above and below, or use verticalAlign/textAlignVertical

Common fix for vertically centered placeholder:

- Add `textAlignVertical: 'center'` (Android)
- Ensure paddingVertical is balanced (not just paddingTop)

If using multiline TextInput, the placeholder might align to top by default.
For single-line input, ensure height and lineHeight create centered text.
</action>
<verify>Placeholder text appears vertically centered in the input field</verify>
<done>Input placeholder has equal padding above and below</done>
</task>

<task type="auto">
  <name>Task 6: Fix UAT-017 - Keyboard covers comments content</name>
  <files>src/components/comments/CommentsBottomSheet.js, src/styles/CommentsBottomSheet.styles.js</files>
  <action>
Current implementation removes maxHeight when keyboard is visible but the FlatList still gets covered.

Better approach: Expand sheet height when keyboard appears so comments remain visible.

Fix in CommentsBottomSheet.js:

1. Remove the maxHeight constraint from sheet style when keyboard is visible
2. Let KeyboardAvoidingView push the entire sheet up
3. Ensure the FlatList can still scroll to show comments

Update the sheet style dynamically:

```jsx
<Animated.View
  style={[
    styles.sheet,
    { transform: [{ translateY }] },
    keyboardVisible && { maxHeight: undefined, flex: 1 }
  ]}
>
```

Also update keyboardAvoidContainer when keyboard visible:

```jsx
style={[
  styles.keyboardAvoidContainer,
  keyboardVisible && { maxHeight: undefined, flex: 0.9 }
]}
```

This allows the sheet to grow taller when keyboard is open, pushing content up.
</action>
<verify>When keyboard opens, comments list remains visible (scrollable above keyboard)</verify>
<done>Comments content visible above keyboard when typing</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] UAT-015: Comment preview rotates every 2 seconds
- [ ] UAT-016: "View all comments" appears only on feed cards, not in modal
- [ ] UAT-011: Comment preview aligns with username
- [ ] UAT-019: No excess gap when no comments exist
- [ ] UAT-018: Input placeholder vertically centered
- [ ] UAT-017: Comments visible when keyboard is open
</verification>

<success_criteria>

- All 6 UAT issues from 36-03-ISSUES.md addressed
- Build passes without errors
- Ready for re-verification with /gsd:verify-work 36-03
  </success_criteria>

<output>
After completion, create `.planning/phases/36-comments-feature/36-03-FIX-2-SUMMARY.md`
</output>
