---
phase: 37.1-darkroom-visual-feedback
plan: 01
type: execute
domain: react-native
---

<objective>
Add functional visual feedback to the darkroom button showing photo state (developing vs ready) and replace press-and-hold reveal with swipe-to-reveal gesture.

Purpose: Users instantly understand darkroom state at a glance and enjoy a more intuitive reveal interaction.
Output: Darkroom card button with gradient state indication, swipe-to-reveal bottom sheet with arrow affordance.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/37.1-darkroom-visual-feedback/37.1-CONTEXT.md

**Key files:**
@src/screens/CameraScreen.js
@src/styles/CameraScreen.styles.js
@src/components/DarkroomBottomSheet.js
@src/constants/colors.js

**Design tokens available:**

- `colors.brand.gradient.developing`: ['#8B5CF6', '#EC4899'] - purple-heavy (developing)
- `colors.brand.gradient.revealed`: ['#A855F7', '#F472B6'] - pink-heavy (ready)
- `colors.status.ready`: '#22C55E' - green (existing status dot)
- `colors.status.developing`: '#EF4444' - red (existing status dot)

**Current implementation:**

- DarkroomCardButton (CameraScreen.js:76-188): Card stack with solid gray (#2A2A2A) background, count display
- DarkroomBottomSheet.js: Press-and-hold interaction with crescendo haptics, spinner animation
- expo-linear-gradient is already a dependency (used elsewhere in the app)

**Constraints from CONTEXT.md:**

- Count + state clarity in a single glance
- Functional feedback, NOT theatrical
- Keep reveal animation unchanged
- Keep triage gestures unchanged
  </context>

<tasks>

<task type="auto">
  <name>Task 1: Add gradient state indicator to darkroom card button</name>
  <files>src/screens/CameraScreen.js, src/styles/CameraScreen.styles.js</files>
  <action>
Modify DarkroomCardButton component to show gradient colors based on photo state:

1. Import LinearGradient from expo-linear-gradient at top of CameraScreen.js

2. Add hasRevealedPhotos prop to DarkroomCardButton (passed from CameraScreen via darkroomCounts.revealedCount > 0)

3. In DarkroomCardButton's renderCards function, replace the static gray View with a LinearGradient component:
   - When hasRevealedPhotos=true (ready): use `revealed` gradient ['#A855F7', '#F472B6']
   - When hasRevealedPhotos=false (developing): use `developing` gradient ['#8B5CF6', '#EC4899']
   - Apply gradient with start={{ x: 0, y: 0 }} end={{ x: 1, y: 1 }} for diagonal flow
   - Keep existing borderRadius, shadow, and other card styling

4. In CameraScreen.styles.js:
   - Remove backgroundColor from darkroomCard style (gradient provides background)
   - Keep all other card styling (borderRadius, shadow, border)

5. Import colors from constants/colors.js and use the gradient arrays directly

WHY avoid solid colors: The gradient provides visual distinction between states while maintaining the brand aesthetic. A solid color change would be more jarring.
</action>
<verify>Run `npx expo start`, open app on device, verify:

- When all photos are developing: card stack shows purple-heavy gradient
- When photos are ready: card stack shows pink-heavy gradient
- Card count number remains visible and readable on gradient</verify>
  <done>Card stack button visually indicates developing vs ready state via gradient colors</done>
  </task>

<task type="auto">
  <name>Task 2: Replace press-and-hold with swipe-to-reveal gesture</name>
  <files>src/components/DarkroomBottomSheet.js</files>
  <action>
Replace the press-and-hold interaction with a horizontal swipe gesture:

1. Import Gesture and GestureDetector from react-native-gesture-handler (already a project dependency)

2. Add constants at top:
   - SWIPE_THRESHOLD = 200 (pixels to swipe for completion)
   - ARROW_SIZE = 24

3. Replace the holdButtonContainer's responder props with GestureDetector:
   - Create pan gesture with Gesture.Pan()
   - Track horizontal translation (event.translationX)
   - Only allow positive translation (left to right)
   - Update progressValue based on translationX / SWIPE_THRESHOLD
   - Clamp progressValue between 0 and 1

4. Keep crescendo haptics logic:
   - Start haptics when pan begins (onStart callback)
   - Continue haptics based on progress value
   - Stop haptics on end/cancel

5. Swipe completion logic (in onEnd callback):
   - If translationX >= SWIPE_THRESHOLD: trigger reveal (call onComplete)
   - If translationX < SWIPE_THRESHOLD: spring back progress to 0

6. Update button visual:
   - Replace spinner icon with arrow icon (chevron-right pointing right)
   - Arrow should translate with the swipe (translateX matches gesture)
   - Keep existing fill animation (progressWidth animates background fill)
   - Text changes: "Swipe to reveal photos" (at rest), "Revealing..." (during swipe)

7. Arrow icon component (simple chevron):
   - Use View-based triangle or SVG Path
   - Color: COLORS.textPrimary
   - Position: left side of button, moves with swipe

8. Keep existing SpinnerIcon for potential reuse but don't render it in the button

WHY swipe over hold: More intuitive interaction - users see the arrow affordance and naturally want to pull it. Faster to complete than holding for 1.6 seconds.
</action>
<verify>Run `npx expo start`, open darkroom bottom sheet, verify:

- Arrow icon visible on left side of button
- Swiping right fills button with pink color from left
- Haptics pulse during swipe (crescendo pattern)
- Completing swipe triggers reveal callback
- Partial swipe springs back to start
- Button text updates during interaction</verify>
  <done>Swipe-to-reveal gesture works with arrow affordance, haptic feedback, and visual fill animation</done>
  </task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Darkroom visual feedback system with gradient card state and swipe-to-reveal gesture</what-built>
  <how-to-verify>
    1. Run: npx expo start
    2. Open app on physical iOS device
    3. Take a photo (puts it in darkroom as "developing")
    4. Check card stack button: Should show purple-heavy gradient
    5. Wait for photo to reveal (or trigger via Cloud Function)
    6. Check card stack button: Should show pink-heavy gradient (ready state)
    7. Tap card stack to open bottom sheet
    8. Verify arrow icon visible in reveal button
    9. Swipe right on button - verify:
       - Fill animates left to right
       - Haptics pulse during swipe
       - Arrow moves with finger
    10. Complete full swipe - verify reveal triggers
    11. Open sheet again, partial swipe - verify springs back
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] Card stack shows gradient based on developing/ready state
- [ ] Swipe gesture triggers reveal on completion
- [ ] Haptic feedback works during swipe
- [ ] Visual fill animation works correctly
- [ ] No TypeScript/ESLint errors
- [ ] App runs without crashes
</verification>

<success_criteria>

- Darkroom card button displays gradient based on photo state
- Swipe-to-reveal gesture replaces press-and-hold
- Arrow affordance visible and moves with swipe
- Crescendo haptics maintained during swipe interaction
- All existing darkroom functionality preserved
  </success_criteria>

<output>
After completion, create `.planning/phases/37.1-darkroom-visual-feedback/37.1-01-SUMMARY.md`
</output>
