---
phase: 31-personalization-scaffolding
plan: 01
type: execute
---

<objective>
Create ThemeContext infrastructure for user accent color personalization.

Purpose: Enable future color customization by establishing a React Context pattern that provides accent colors to components via useTheme hook, with preset palettes and AsyncStorage persistence.
Output: ThemeContext provider, useTheme hook, preset palette definitions, App.js integration with persistence.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/31-personalization-scaffolding/31-CONTEXT.md

# Context from Phase 30 (Rebrand):

@.planning/phases/30-rewind-rebrand/30-01-SUMMARY.md

# Existing patterns to follow:

@src/context/AuthContext.js

# Current design tokens:

@src/constants/colors.js

**Tech stack available:** React Context API, AsyncStorage
**Established patterns:** AuthContext pattern (createContext, useContext, Provider)
**Key files:** src/constants/colors.js (brand.purple, brand.pink, gradients)

**Phase requirements (from 31-CONTEXT.md):**

- ThemeContext provides colors via useTheme hook
- Preset color palettes (purple default, plus alternatives)
- Primary UI elements affected: buttons, hold-to-reveal ring, active tab indicators
- Out of scope: color picker UI (comes later), dark/light toggle, gradient overhauls
  </context>

<tasks>

<task type="auto">
  <name>Task 1: Create ThemeContext with preset palettes</name>
  <files>src/context/ThemeContext.js, src/context/index.js</files>
  <action>
Create ThemeContext following the AuthContext pattern:

1. Define PALETTES object with preset accent colors:
   - 'purple' (default): { accent: '#8B5CF6', accentSecondary: '#EC4899' } - current Rewind brand
   - 'blue': { accent: '#3B82F6', accentSecondary: '#06B6D4' } - blue/cyan variant
   - 'green': { accent: '#22C55E', accentSecondary: '#84CC16' } - green/lime variant
   - 'orange': { accent: '#F97316', accentSecondary: '#FBBF24' } - orange/amber variant

2. Create ThemeContext with createContext({})

3. Create useTheme hook that returns context value, throws if used outside ThemeProvider

4. Create ThemeProvider component that:
   - useState for currentPalette (default: 'purple')
   - Derives theme object from PALETTES[currentPalette] merged with static colors from constants
   - Provides { theme, currentPalette, setPalette, palettes: Object.keys(PALETTES) }
   - theme object structure: { accent, accentSecondary, ...rest of colors spread }

5. Export ThemeProvider, useTheme, PALETTES

6. Update src/context/index.js to export from ThemeContext.js

Do NOT add persistence yet - that comes in Task 2.
Do NOT modify colors.js - the static colors remain unchanged.
</action>
<verify>File exists at src/context/ThemeContext.js with ThemeProvider, useTheme, PALETTES exports. Index exports them.</verify>
<done>ThemeContext.js created with 4 preset palettes, useTheme hook follows AuthContext pattern, exports added to index.js</done>
</task>

<task type="auto">
  <name>Task 2: Wire ThemeProvider into App.js with persistence</name>
  <files>src/context/ThemeContext.js, App.js</files>
  <action>
1. Update ThemeContext.js to add AsyncStorage persistence:
   - Import AsyncStorage from @react-native-async-storage/async-storage
   - Add THEME_STORAGE_KEY = '@rewind_theme_palette'
   - Add useEffect to load saved palette on mount (try/catch, default to 'purple' on error)
   - Update setPalette to also persist to AsyncStorage
   - Add loading state during initial load (initializing boolean like AuthContext)

2. Update App.js to wrap with ThemeProvider:
   - Import { ThemeProvider } from './src/context'
   - Wrap existing component tree: ThemeProvider should be INSIDE NavigationContainer but OUTSIDE AuthProvider
   - Order: NavigationContainer > ErrorBoundary > ThemeProvider > AuthProvider > rest
   - This order ensures theme is available to auth screens

No changes to any screens or components yet - just infrastructure wiring.
</action>
<verify>App.js imports ThemeProvider and wraps component tree. Theme persists across app restart (can verify later with useTheme in any component).</verify>
<done>ThemeProvider wraps app in correct order, AsyncStorage persistence loads/saves palette, no console errors on launch</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] ThemeContext.js exists with PALETTES, ThemeProvider, useTheme exports
- [ ] src/context/index.js exports ThemeContext items
- [ ] App.js wraps component tree with ThemeProvider
- [ ] No TypeScript/ESLint errors
- [ ] App launches without console errors
- [ ] Can verify context works by temporarily adding useTheme() to a component
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- ThemeContext infrastructure ready for future palette switching
- No visual changes to app (infrastructure only)
- Palette defaults to 'purple' (current Rewind brand)
  </success_criteria>

<output>
After completion, create `.planning/phases/31-personalization-scaffolding/31-01-SUMMARY.md`:

# Phase 31 Plan 01: Theme Context Infrastructure Summary

**[Substantive one-liner - what shipped]**

## Accomplishments

- [Key outcome 1]
- [Key outcome 2]

## Files Created/Modified

- `path/to/file.ts` - Description
- `path/to/another.ts` - Description

## Decisions Made

[Key decisions and rationale, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Phase Readiness

[Ready for Phase 32 or notes about future migration to useTheme]
</output>
