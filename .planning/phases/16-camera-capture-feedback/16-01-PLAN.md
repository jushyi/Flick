---
phase: 16-camera-capture-feedback
plan: 01
type: execute
---

<objective>
Implement DSLR-style two-stage haptic feedback and contained camera flash for a mechanical shutter feel.

Purpose: Make photo capture feel instant and tactile like a real camera shutter.
Output: Enhanced capture feedback with two-stage haptics and camera-bounded flash.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/16-camera-capture-feedback/16-CONTEXT.md
@src/screens/CameraScreen.js
@src/utils/haptics.js

**From Phase 15.2-03 Summary:**
- Card capture animation (`playCardCaptureAnimation`) already provides satisfying visual feedback
- Flash effect already fires immediately on shutter press
- Haptic feedback already triggers via `lightImpact()`

**Current Implementation (CameraScreen.js):**
- Single `lightImpact()` call on tap (line 356)
- Full-screen flash overlay (lines 890-898: `top: 0, left: 0, right: 0, bottom: 0`)
- Flash fires immediately after haptic (line 360)

**What Needs to Change:**
1. Two-stage haptic: light on press-down (onPressIn), stronger punch on release/capture (onPressOut)
2. Flash overlay bounded to camera preview container only (not full screen)
3. Slightly more pronounced flash (increase opacity from 0.8 to ~0.9)

**Constraints from CONTEXT.md:**
- No shutter sounds (haptic + visual only)
- No button redesign (already done in 15.2)
- No changes to darkroom card animation (already done in 15.2)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement two-stage DSLR-style haptic feedback</name>
  <files>src/screens/CameraScreen.js</files>
  <action>
  Convert capture button from TouchableOpacity to Pressable (React Native core) to get onPressIn/onPressOut events.

  Implementation:
  1. Import `Pressable` from 'react-native' (already available in RN)
  2. Replace the capture button TouchableOpacity with Pressable
  3. Add `onPressIn` handler that calls `lightImpact()` - this is the first "touch" feel
  4. Move the actual capture logic to `onPressOut` handler with `mediumImpact()` before capture starts
  5. Import `mediumImpact` from haptics utility (already exported)

  The two-stage pattern:
  - onPressIn: `lightImpact()` - subtle feedback on finger down (like half-press shutter)
  - onPressOut: `mediumImpact()` then capture - punchier feedback on release (like full shutter click)

  Keep the existing `isCapturing` and `disabled` logic but apply to Pressable.
  Maintain existing activeOpacity behavior using Pressable's `style` function with pressed state.
  </action>
  <verify>
  1. Run app, navigate to Camera tab
  2. Press and HOLD capture button - should feel light haptic immediately on touch
  3. Release finger - should feel stronger/punchier haptic, then flash fires
  4. Verify no haptic delay - both should feel instant
  </verify>
  <done>Two-stage haptic: light on press-down, medium on release/capture</done>
</task>

<task type="auto">
  <name>Task 2: Contain flash overlay to camera preview bounds</name>
  <files>src/screens/CameraScreen.js</files>
  <action>
  Move flash overlay inside the camera container instead of being a full-screen overlay.

  Current state:
  - `flashOverlay` style: `position: absolute, top: 0, left: 0, right: 0, bottom: 0` (full screen)
  - Flash renders at end of component, outside camera container

  Changes:
  1. Move the flash overlay Animated.View INSIDE the `cameraContainer` View (after CameraView)
  2. Update `flashOverlay` style to use `StyleSheet.absoluteFillObject` or equivalent (fills parent container)
  3. Set proper borderRadius on flash overlay to match camera container corners (CAMERA_BORDER_RADIUS = 24)
  4. Increase flash opacity from 0.8 to 0.9 for more pronounced effect
  5. Ensure overflow: 'hidden' on cameraContainer clips the flash properly

  The flash should:
  - Only appear within the rounded camera preview area
  - Have rounded bottom corners matching the camera preview (borderBottomLeftRadius, borderBottomRightRadius = 24)
  - Not cover the footer or floating controls
  - Be slightly brighter than before (0.9 vs 0.8)
  </action>
  <verify>
  1. Run app, take a photo
  2. Observe flash - should only illuminate camera preview area
  3. Footer controls should NOT flash white
  4. Flash should respect rounded corners of camera preview
  5. Flash should feel slightly brighter/more pronounced than before
  </verify>
  <done>Flash contained to camera preview with rounded corners, 0.9 opacity</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>DSLR-style capture feedback with two-stage haptics and contained flash</what-built>
  <how-to-verify>
    1. Run: npx expo start, open on iOS device
    2. Navigate to Camera tab
    3. Test two-stage haptic:
       - Press and HOLD capture button (don't release) - feel light haptic immediately
       - Release finger - feel stronger "click" haptic, then flash fires
       - The two haptics should feel distinct, like a real camera shutter
    4. Test contained flash:
       - Take a photo
       - Observe flash stays within camera preview bounds only
       - Footer (black area with capture button) does NOT flash
       - Flash respects rounded corners at bottom of camera preview
    5. Test overall feel:
       - Capture should feel instant (< 100ms perceived)
       - No perceptible delay between tap and feedback
       - Feel like a real camera shutter: mechanical, tactile, satisfying
  </how-to-verify>
  <resume-signal>Type "approved" if capture feels like a real camera shutter, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] Two-stage haptic implemented: light on press, medium on release
- [ ] Flash contained to camera preview (not full screen)
- [ ] Flash respects camera preview rounded corners
- [ ] Flash opacity increased to 0.9
- [ ] No perceptible delay between tap and feedback
- [ ] App builds and runs without errors
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- Capture feels instant and mechanical like a DSLR shutter
- Human verification approved
</success_criteria>

<output>
After completion, create `.planning/phases/16-camera-capture-feedback/16-01-SUMMARY.md`:

# Phase 16 Plan 01: Camera Capture Feedback Summary

**[Substantive one-liner about what shipped]**

## Accomplishments

- [Key outcome 1]
- [Key outcome 2]

## Files Created/Modified

- `src/screens/CameraScreen.js` - Description

## Decisions Made

[Key decisions and rationale, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Phase Readiness

Phase 16 complete, ready for Phase 16.1 (Darkroom Bottom Sheet UI Overhaul)
</output>
