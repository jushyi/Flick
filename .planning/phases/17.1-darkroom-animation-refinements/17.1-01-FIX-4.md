---
phase: 17.1-darkroom-animation-refinements
plan: 01-FIX-4
type: fix
---

<objective>
Fix 2 UAT issues from plan 17.1-01.

Source: 17.1-01-ISSUES.md
Priority: 0 critical, 2 major, 0 minor
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md

**Issues being fixed:**
@.planning/phases/17.1-darkroom-animation-refinements/17.1-01-ISSUES.md

**Original plan for reference:**
@.planning/phases/17.1-darkroom-animation-refinements/17.1-01-PLAN.md

**Current implementation:**
@src/screens/DarkroomScreen.js
@src/components/SwipeablePhotoCard.js
@src/navigation/AppNavigator.js
</context>

<tasks>

<task type="auto">
  <name>Fix UAT-007: White background during header swipe</name>
  <files>src/navigation/AppNavigator.js</files>
  <action>
The white background visible during header swipe-down gesture comes from React Navigation's default card background color. When GestureHandlerRootView is transparent and the inner ReAnimated.View has black background, the navigation layer's white background shows through.

Fix by setting the navigation card background to black for the Darkroom screen:

In AppNavigator.js, find the Darkroom screen definition in the stack navigator and add cardStyle option:

```javascript
<Stack.Screen
  name="Darkroom"
  component={DarkroomScreen}
  options={{
    animation: 'slide_from_bottom',
    presentation: 'card',
    cardStyle: { backgroundColor: '#000000' },
  }}
/>
```

Or if using React Navigation 6+ with native stack, use `contentStyle` instead:

```javascript
options={{
  animation: 'slide_from_bottom',
  contentStyle: { backgroundColor: '#000000' },
}}
```

This ensures the underlying navigation layer is black, so when the darkroom content moves during header swipe, black shows behind instead of white.
  </action>
  <verify>
1. Open darkroom with photos
2. Swipe down on header area slowly
3. Verify background behind darkroom content is BLACK, not white
4. Single cohesive screen movement - no double-screen visual effect
  </verify>
  <done>Header swipe shows black background, creating single cohesive sheet appearance</done>
</task>

<task type="auto">
  <name>Fix UAT-008: Remove delete overlay from gesture swipes</name>
  <files>src/components/SwipeablePhotoCard.js</files>
  <action>
The delete gesture was removed (delete is button-only now), but the delete overlay still renders and can show during swipes due to the arc motion or residual translateY values. Since delete is strictly button-triggered, remove the delete overlay from rendering during gesture interactions.

**Change the delete overlay to only show during button-triggered animations:**

The delete overlay currently checks `translateY.value > 0`. During gesture swipes, `translateY.value` stays at 0 (the visual arc comes from `arcY` calculation), but during button-triggered delete animation, `translateY.value` animates to `SCREEN_HEIGHT`.

Add a flag to track when a button-triggered delete is in progress, and only show delete overlay then:

1. Add a new shared value to track button-triggered delete:
```javascript
const isButtonDelete = useSharedValue(false);
```

2. In `triggerDelete` imperative method, set the flag before animating:
```javascript
triggerDelete: () => {
  if (actionInProgress.value) return;
  logger.info('SwipeablePhotoCard: triggerDelete called', { photoId: photo?.id });
  actionInProgress.value = true;
  isButtonDelete.value = true; // UAT-008: Mark as button-triggered delete
  // ... rest of animation
}
```

3. Update `deleteOverlayStyle` to only show when `isButtonDelete` is true:
```javascript
const deleteOverlayStyle = useAnimatedStyle(() => {
  // UAT-008: Only show delete overlay during button-triggered delete animation
  if (!isButtonDelete.value) return { opacity: 0 };

  const opacity = translateY.value > 0
    ? interpolate(translateY.value, [0, DELETE_OVERLAY_THRESHOLD], [0, 0.7], 'clamp')
    : 0;

  return { opacity };
});
```

This ensures the delete overlay ONLY appears when the delete button is pressed, never during gesture swipes (even diagonal ones).
  </action>
  <verify>
1. Open darkroom with photos
2. Perform various swipes (horizontal, diagonal, fast, slow)
3. Verify delete overlay (red with X) NEVER appears during any swipe gesture
4. Verify archive overlay (gray) shows on left swipes
5. Verify journal overlay (green) shows on right swipes
6. Tap delete button - verify delete overlay DOES appear during button animation
  </verify>
  <done>Delete overlay only shows during button-triggered delete, never during gesture swipes</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Fixed header swipe background and removed delete overlay from gestures</what-built>
  <how-to-verify>
    1. Run `npx expo start` and open app on device
    2. Capture a photo and trigger reveal so darkroom has photos
    3. Open darkroom
    4. TEST UAT-007: Swipe down on header slowly
       - Verify background behind content is BLACK (not white)
       - Should look like single cohesive sheet sliding down
    5. TEST UAT-008: Try various swipes on photo card
       - Fast diagonal swipes: NO red delete overlay should appear
       - Any direction swipe: Only gray (archive) or green (journal) overlays
    6. Verify normal swipes still work:
       - Left swipe: Archive (gray overlay, archives photo)
       - Right swipe: Journal (green overlay, journals photo)
    7. Verify delete button shows red overlay:
       - Tap red X button: Red delete overlay SHOULD appear during animation
  </how-to-verify>
  <resume-signal>Type "approved" or describe any remaining issues</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Header swipe shows black background (no white visible)
- [ ] Delete overlay never appears during gesture swipes
- [ ] Archive/journal overlays still work on horizontal swipes
- [ ] Delete button still shows red overlay when pressed
- [ ] No visual glitches during any animations
</verification>

<success_criteria>
- UAT-007: Single cohesive sheet appearance during header swipe
- UAT-008: Delete overlay only shows on button press, not during swipes
- All existing triage functionality preserved
</success_criteria>

<output>
After completion, create `.planning/phases/17.1-darkroom-animation-refinements/17.1-01-FIX-4-SUMMARY.md`
</output>
