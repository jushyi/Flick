---
phase: 12.1-friends-list-screen-crash-fix
plan: 01-FIX2
subsystem: social
tags: [firestore, friendships, query, client-side-filtering]

# Dependency graph
requires:
  - phase: 12.1-01-FIX
    provides: modular or() function pattern for friendship queries
provides:
  - getSentRequests uses single-field query with client-side filtering
affects: [friend-requests-screen, sent-requests-tab]

# Tech tracking
tech-stack:
  added: []
  patterns: [single-field-query-with-client-side-filtering]

key-files:
  created: []
  modified: [src/services/firebase/friendshipService.js]

key-decisions:
  - "Use single-field query to avoid Firestore composite index requirement"
  - "Filter pending status client-side (consistent with existing patterns)"

patterns-established:
  - "Client-side filtering for status field after user-based OR queries"

issues-created: []

# Metrics
duration: 3min
completed: 2026-01-19
---

# Phase 12.1 Plan 01-FIX2: Fix getSentRequests Permission Error Summary

**Single-field query with client-side filtering fixes compound query permission error in getSentRequests**

## Performance

- **Duration:** 3 min
- **Started:** 2026-01-19T15:30:00Z
- **Completed:** 2026-01-19T15:33:00Z
- **Tasks:** 1
- **Files modified:** 1

## Accomplishments

- Fixed getSentRequests compound query that caused Firestore permission error
- Changed from `where('requestedBy', '==', userId), where('status', '==', 'pending')` to single-field query
- Added client-side filtering for pending status (consistent with getFriendships and getPendingRequests patterns)

## Task Commits

Each task was committed atomically:

1. **Task 1: Fix UAT-002 - getSentRequests compound query permission error** - `843951d` (fix)

## Files Created/Modified

- `src/services/firebase/friendshipService.js` - Changed getSentRequests to use single-field query with client-side status filtering

## Decisions Made

- Use single-field query by `requestedBy` only (avoids Firestore composite index requirement)
- Filter for `status === 'pending'` client-side (consistent with existing patterns in getFriendships and getPendingRequests)

## Deviations from Plan

None - plan executed exactly as written.

## Issues Encountered

None.

## Next Phase Readiness

- UAT-002 (getSentRequests permission error) resolved
- Ready for re-verification of Friend Requests Sent tab
- Phase 12.1 complete, ready for Phase 13

---
*Phase: 12.1-friends-list-screen-crash-fix*
*Completed: 2026-01-19*
