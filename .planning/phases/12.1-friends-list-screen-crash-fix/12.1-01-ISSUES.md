# UAT Issues: Phase 12.1 Plan 01

**Tested:** 2026-01-19
**Source:** .planning/phases/12.1-friends-list-screen-crash-fix/12.1-01-SUMMARY.md
**Tester:** User via /gsd:verify-work

## Open Issues

None.

## Resolved Issues

### UAT-002: Sent requests tab fails with permission error

**Discovered:** 2026-01-19
**Resolved:** 2026-01-19
**Phase/Plan:** 12.1-01-FIX2
**Severity:** Major
**Feature:** Friend Requests - Sent tab
**Description:** When navigating to the Friend Requests screen and viewing the "Sent" tab, an error occurs: "Error fetching sent requests (the caller does not have permission to execute the specified operation.)"
**Expected:** Sent friend requests should load and display
**Actual:** Permission error prevents loading sent requests
**Repro:**
1. Open app
2. Navigate to Friends tab
3. Go to Friend Requests
4. Switch to "Sent" tab
5. Error appears

**Root Cause:**
The `getSentRequests` function used a compound query with two `where` clauses:
```javascript
query(
  collection(db, 'friendships'),
  where('requestedBy', '==', userId),
  where('status', '==', 'pending')
);
```
This compound query requires a Firestore composite index.

**Solution Applied:**
1. Changed to single-field query: `where('requestedBy', '==', userId)`
2. Added client-side filtering: `if (data.status === 'pending')`
3. Pattern consistent with getFriendships and getPendingRequests

**Fix Commit:** 843951d

### UAT-001: Filter.where is not a function - FriendsListScreen still crashes

**Discovered:** 2026-01-19
**Resolved:** 2026-01-19
**Phase/Plan:** 12.1-01-FIX
**Severity:** Blocker
**Feature:** FriendsListScreen loading
**Description:** FriendsListScreen crashes on load with ErrorBoundary. The fix applied for Filter.or is not working correctly.
**Expected:** FriendsListScreen loads showing friends list or empty state
**Actual:** Screen crashes with error: `TypeError: firestore.default.Filter.where is not a function (it is undefined)`
**Repro:**
1. Launch app
2. Navigate to Friends tab
3. Screen immediately crashes to ErrorBoundary

**Root Cause:** Both the named Filter import and `firestore.Filter.or()` patterns don't work in React Native Firebase v22+. The modular API exports `or` and `where` as standalone functions that compose directly.

**Solution Applied:**
1. Added `or` to named imports: `import { ..., or, where } from '@react-native-firebase/firestore'`
2. Changed query pattern from `where(firestore.Filter.or(firestore.Filter.where(...)))` to `or(where(...), where(...))`
3. Fixed all 3 locations: getFriendships, getPendingRequests, subscribeFriendships

**Fix Commit:** d9e5f10

---

*Phase: 12.1-friends-list-screen-crash-fix*
*Plan: 01*
*Tested: 2026-01-19*
