---
phase: 12.1-friends-list-screen-crash-fix
plan: 01-FIX
subsystem: social
tags: [firebase, firestore, react-native-firebase, or-query, friendship]

# Dependency graph
requires:
  - phase: 12.1
    provides: Investigation of Filter.or error root cause
provides:
  - Working modular or() queries for friendship service
  - FriendsListScreen loads without crash
affects: [Phase 13, Phase 14]

# Tech tracking
tech-stack:
  added: []
  patterns:
    - "React Native Firebase modular or() function for OR queries"

key-files:
  created: []
  modified:
    - src/services/firebase/friendshipService.js

key-decisions:
  - "Use modular or(where(...), where(...)) pattern instead of firestore.Filter.or()"

patterns-established:
  - "Modular API or() and where() functions compose directly without wrapping"

issues-created: []

# Metrics
duration: 5min
completed: 2026-01-19
---

# Phase 12.1 Plan 01-FIX: Use Modular or() Function Summary

**Fixed FriendsListScreen crash by replacing firestore.Filter.or/Filter.where pattern with modular or(where(...), where(...)) pattern per React Native Firebase v22+ modular API**

## Performance

- **Duration:** 5 min
- **Started:** 2026-01-19
- **Completed:** 2026-01-19
- **Tasks:** 1
- **Files modified:** 1

## Accomplishments

- Added `or` to named imports from `@react-native-firebase/firestore`
- Replaced all 3 occurrences of `firestore.Filter.or(firestore.Filter.where(...))` with `or(where(...), where(...))`
- Fixed getFriendships, getPendingRequests, and subscribeFriendships functions

## Task Commits

1. **Task 1: Fix Filter.or to modular or() function** - `d9e5f10` (fix)

**Plan metadata:** (pending)

## Files Created/Modified

- `src/services/firebase/friendshipService.js` - Changed import pattern and updated 3 OR queries to use modular or() function

## Decisions Made

- Used modular `or(where(...), where(...))` pattern which is the correct approach for React Native Firebase v22+ modular API
- The `or()` function is a standalone query constraint, not something wrapped in `where()`

## Deviations from Plan

None - plan executed exactly as written.

## Issues Encountered

None

## Resolution of UAT-001

**Issue:** `TypeError: firestore.default.Filter.where is not a function (it is undefined)`

**Root Cause:** The previous fix used `firestore.Filter.or()` and `firestore.Filter.where()` via the default import, but the React Native Firebase modular API exports `or` and `where` as standalone functions that compose directly.

**Solution:** Import `or` as a named export and use `or(where(...), where(...))` pattern.

## Next Phase Readiness

- Phase 12.1 complete (FIX applied)
- FriendsListScreen should now load without ErrorBoundary catching crash
- Ready for re-verification via /gsd:verify-work
- If verification passes, ready for Phase 13 (Production Build & Branding)

---
*Phase: 12.1-friends-list-screen-crash-fix*
*Completed: 2026-01-19*
