---
phase: 36.1-comment-sheet-fullscreen
plan: 01
type: execute
---

<objective>
Add swipe-up gesture to expand comment sheet to fullscreen with mini photo header.

Purpose: Allow users to view and scroll through more comments in an expanded fullscreen view
Output: CommentsBottomSheet with bidirectional gesture (swipe up to expand, swipe down to collapse/close) and mini photo thumbnail when expanded
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/36.1-comment-sheet-fullscreen/36.1-CONTEXT.md

# Key source files:

@src/components/comments/CommentsBottomSheet.js
@src/styles/CommentsBottomSheet.styles.js

# Reference for modal patterns:

@src/components/PhotoDetailModal.js

**Phase context (from discuss-phase):**

- Buttery smooth gesture transitions - must feel fluid
- Mini photo thumbnail at top when expanded (maintains context)
- Velocity-based snapping: fast swipes snap to full/collapsed, slow drags allow positioning
- Swipe down collapses back to normal position
- Instagram-style expand/collapse behavior as reference
- Out of scope: new features in fullscreen, keyboard handling changes

**Current implementation:**

- SHEET_HEIGHT = SCREEN_HEIGHT \* 0.6 (fixed 60%)
- PanResponder on handle bar for swipe-down-to-close only
- sheetTranslateY animated value for keyboard movement
- swipeY animated value for close gesture tracking

**What needs to change:**

- Add isExpanded state to track fullscreen mode
- Modify PanResponder to handle bidirectional swipes
- Add animated height interpolation (60% <-> ~95%)
- Add mini photo header when expanded
- Pass photoUrl prop for thumbnail display
  </context>

<tasks>

<task type="auto">
  <name>Task 1: Add bidirectional expand/collapse gesture</name>
  <files>src/components/comments/CommentsBottomSheet.js, src/styles/CommentsBottomSheet.styles.js</files>
  <action>
  Add expanded state and bidirectional gesture handling:

1. Add state and constants in CommentsBottomSheet.js:
   - Add `isExpanded` state (boolean, default false)
   - Add `EXPANDED_HEIGHT = SCREEN_HEIGHT * 0.95` constant in styles file
   - Add animated value `sheetHeight` initialized to SHEET_HEIGHT

2. Modify PanResponder to handle up/down:
   - Track gesture direction: dy < -10 = swipe up, dy > 10 = swipe down
   - Swipe UP when collapsed: animate sheetHeight to EXPANDED_HEIGHT, setIsExpanded(true)
   - Swipe DOWN when expanded: animate sheetHeight to SHEET_HEIGHT, setIsExpanded(false)
   - Swipe DOWN when collapsed: existing close behavior (animate out)
   - Apply velocity-based snapping: fast swipe (vy > 0.5 or vy < -0.5) snaps immediately
   - Slow drag without velocity threshold springs back to current state

3. Update sheet style to use animated height:
   - Replace fixed minHeight/maxHeight with animated height value
   - Use Animated.View with style={{ height: sheetHeight }}

4. Export EXPANDED_HEIGHT from styles file alongside SHEET_HEIGHT

Avoid: Don't break existing keyboard handling (sheetTranslateY) - keep all three transforms working together. Don't change the close button or backdrop tap behavior.
</action>
<verify>Run app, open any photo's comments, swipe up on handle bar - sheet should expand. Swipe down - should collapse. Fast swipes snap, slow drags spring back.</verify>
<done>Bidirectional gesture working: swipe up expands to ~95% height, swipe down collapses to 60% or closes if already collapsed</done>
</task>

<task type="auto">
  <name>Task 2: Add mini photo header when expanded</name>
  <files>src/components/comments/CommentsBottomSheet.js, src/styles/CommentsBottomSheet.styles.js, src/components/PhotoDetailModal.js</files>
  <action>
  Add photo context header that appears in expanded mode:

1. Add photoUrl prop to CommentsBottomSheet:
   - New prop: `photoUrl` (string) - URL of the photo being commented on
   - Update PropTypes if present

2. Pass photoUrl from PhotoDetailModal:
   - Find where CommentsBottomSheet is rendered
   - Pass the current photo's imageURL as photoUrl prop

3. Create mini photo header component (inside CommentsBottomSheet):
   - Only render when `isExpanded` is true
   - Position between handle bar and "Comments" header
   - Small thumbnail image (48x48 or 56x56, rounded corners 8px)
   - Use expo-image Image component for consistency with codebase
   - Light border (1px rgba(255,255,255,0.1)) around thumbnail
   - Vertically centered in a row with horizontal padding matching header

4. Add styles for expanded header:
   - `expandedPhotoHeader` container: flexDirection row, alignItems center, paddingHorizontal 16, paddingVertical 8
   - `miniPhotoThumbnail`: width/height 48-56, borderRadius 8, border styling

5. Animate header appearance:
   - Use opacity animation (0 when collapsed, 1 when expanded)
   - Transition should feel smooth, not abrupt

Avoid: Don't make the thumbnail too large - it should provide context, not dominate. Keep it subtle.
</action>
<verify>Run app, expand comment sheet - mini photo thumbnail should appear smoothly. Collapse - thumbnail should fade out. Photo matches the one being viewed.</verify>
<done>Mini photo header visible only when expanded, shows correct photo thumbnail, smooth opacity transition</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Fullscreen expand/collapse for comment sheet with mini photo header</what-built>
  <how-to-verify>
    1. Run: npx expo start
    2. Open any photo (feed or stories)
    3. Tap comment button to open comment sheet
    4. TEST EXPAND: Swipe up on the handle bar
       - Sheet should smoothly expand to near-fullscreen (~95% height)
       - Mini photo thumbnail should appear at top
       - Comments list should have more visible space
    5. TEST COLLAPSE: Swipe down on the handle bar
       - Sheet should collapse back to normal height (60%)
       - Mini photo thumbnail should fade out
    6. TEST VELOCITY SNAPPING: Try fast swipe up, then fast swipe down
       - Fast swipes should snap instantly to expanded/collapsed
    7. TEST SLOW DRAG: Drag handle slowly partway, then release
       - Should spring back to current state (not snap to opposite)
    8. TEST CLOSE: When collapsed, swipe down
       - Should close the sheet entirely (existing behavior preserved)
    9. TEST KEYBOARD: Tap comment input when collapsed
       - Keyboard should still push sheet up correctly
    10. TEST KEYBOARD EXPANDED: Expand, then tap input
        - Keyboard behavior should work in expanded mode too
  </how-to-verify>
  <resume-signal>Type "approved" if all behaviors work smoothly, or describe any issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] Swipe up on handle bar expands sheet to ~95% height
- [ ] Swipe down on handle bar collapses sheet to 60% height
- [ ] Swipe down when collapsed closes sheet entirely
- [ ] Fast swipes snap to full/collapsed state
- [ ] Slow drags spring back to current state
- [ ] Mini photo header appears when expanded
- [ ] Mini photo header shows correct photo thumbnail
- [ ] Keyboard handling still works in both states
- [ ] No TypeScript/linting errors: `npm run lint`
- [ ] App builds without errors: `npx expo start`
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- Gesture feels buttery smooth (no jank or stutter)
- Expand/collapse behavior matches Instagram-style reference
- Keyboard handling preserved in both states
- Mini photo provides visual context without dominating
  </success_criteria>

<output>
After completion, create `.planning/phases/36.1-comment-sheet-fullscreen/36.1-01-SUMMARY.md` with:
- Implementation details (gesture thresholds, animation configs)
- Files modified
- Any deviations or decisions made
- Issues encountered and resolutions
</output>
