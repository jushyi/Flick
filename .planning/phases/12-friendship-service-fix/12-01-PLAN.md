---
phase: 12-friendship-service-fix
plan: 01
type: execute
---

<objective>
Fix DocumentSnapshot.exists() method calls across all services and screens to use correct modular API syntax.

Purpose: The migration to modular Firestore API (Phase 11) introduced a bug - `exists` changed from a property to a method but code still uses property syntax, causing friendship features to fail.
Output: All services and screens correctly use `exists()` method syntax, friendship features work correctly.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/11-firebase-modular-api/11-02-SUMMARY.md

**Bug Analysis:**
In React Native Firebase modular API, DocumentSnapshot.exists is a METHOD, not a property:
- WRONG: `docSnap.exists` (returns the method itself, always truthy)
- CORRECT: `docSnap.exists()` (returns boolean)

**Files Affected:**
1. `src/services/firebase/friendshipService.js` - 5 occurrences (lines 63, 109, 160, 199, 376)
2. `src/services/firebase/feedService.js` - 6 occurrences (lines 33, 108, 167, 176, 218, 297)
3. `src/screens/FriendsListScreen.js` - 1 occurrence (line 72)
4. `src/components/FriendRequestCard.js` - 1 occurrence (line 53)

**Root Cause:** Phase 11 migrated imports but did not update `.exists` to `.exists()`.
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix friendshipService.js exists() calls</name>
  <files>src/services/firebase/friendshipService.js</files>
  <action>
Change all 5 occurrences of `.exists` to `.exists()`:

1. Line 63: `if (friendshipDocSnap.exists)` → `if (friendshipDocSnap.exists())`
2. Line 109: `if (!friendshipDocSnap.exists)` → `if (!friendshipDocSnap.exists())`
3. Line 160: `if (!friendshipDocSnap.exists)` → `if (!friendshipDocSnap.exists())`
4. Line 199: `if (!friendshipDocSnap.exists)` → `if (!friendshipDocSnap.exists())`
5. Line 376: `if (!friendshipDocSnap.exists)` → `if (!friendshipDocSnap.exists())`

Use search-and-replace with context awareness to ensure correct replacement.
  </action>
  <verify>grep -n "\.exists[^(]" src/services/firebase/friendshipService.js returns 0 matches</verify>
  <done>All 5 exists property usages converted to exists() method calls</done>
</task>

<task type="auto">
  <name>Task 2: Fix feedService.js exists() calls</name>
  <files>src/services/firebase/feedService.js</files>
  <action>
Change all 6 occurrences of `.exists` to `.exists()`:

1. Line 33: `userDocSnap.exists ?` → `userDocSnap.exists() ?`
2. Line 108: `userDocSnap.exists ?` → `userDocSnap.exists() ?`
3. Line 167: `if (!photoDocSnap.exists)` → `if (!photoDocSnap.exists())`
4. Line 176: `userDocSnap.exists ?` → `userDocSnap.exists() ?`
5. Line 218: `userDocSnap.exists ?` → `userDocSnap.exists() ?`
6. Line 297: `if (!photoDocSnap.exists)` → `if (!photoDocSnap.exists())`

Use search-and-replace with context awareness to ensure correct replacement.
  </action>
  <verify>grep -n "\.exists[^(]" src/services/firebase/feedService.js returns 0 matches</verify>
  <done>All 6 exists property usages converted to exists() method calls</done>
</task>

<task type="auto">
  <name>Task 3: Fix screen and component exists() calls</name>
  <files>src/screens/FriendsListScreen.js, src/components/FriendRequestCard.js</files>
  <action>
Fix exists() in screens and components:

1. FriendsListScreen.js line 72: `if (userDoc.exists)` → `if (userDoc.exists())`
2. FriendRequestCard.js line 53: `if (userDoc.exists)` → `if (userDoc.exists())`

Note: The comment "Modular API uses exists as a property" is INCORRECT and should be removed or updated.
  </action>
  <verify>grep -rn "\.exists[^(]" src/screens/FriendsListScreen.js src/components/FriendRequestCard.js returns 0 matches</verify>
  <done>Both screen and component files use correct exists() syntax</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `grep -rn "DocSnap\.exists[^(]" src/` returns 0 matches (no incorrect exists usage)
- [ ] `grep -rn "\.exists()" src/services/firebase/` confirms correct method calls exist
- [ ] App starts without errors: `npx expo start`
- [ ] Friendship features work (can send, accept, decline friend requests)
</verification>

<success_criteria>

- All 13 occurrences of `.exists` converted to `.exists()`
- No remaining property-style exists usage in src/
- Misleading comment about "exists as a property" removed/corrected
- App compiles and runs without Firebase-related errors
</success_criteria>

<output>
After completion, create `.planning/phases/12-friendship-service-fix/12-01-SUMMARY.md`:

# Phase 12 Plan 01: Fix exists() Method Calls Summary

**[One-liner describing what shipped]**

## Accomplishments

- [Key outcomes]

## Files Modified

- `path/to/file.js` - Description

## Decisions Made

[Any decisions, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Step

[Ready for Phase 13 or additional testing needed]
</output>
