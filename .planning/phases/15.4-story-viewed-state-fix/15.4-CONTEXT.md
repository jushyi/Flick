# Phase 15.4: Story Viewed State Fix - Context

**Gathered:** 2026-02-02
**Status:** Ready for planning

<vision>
## How This Should Work

Restore everything to work exactly like it did before Phase 15.3 broke it. When viewing stories, the ring indicator should immediately reflect viewed state — no colored ring after viewing all photos. Stories should resume from the right position: first unviewed photo, or back to photo one if all have been seen.

This state needs to survive sessions. Even after logging out and back in, the app should remember which stories were viewed and resume from the correct spot.

Reactions also need to work like before: tapping a reaction should immediately update the count in real-time as you tap (multiple taps = multiple increments visible immediately). After a couple seconds, the emoji row should reorder itself with highest counts on the left. Right now you have to close and reopen the photo detail to see any updates.

</vision>

<essential>
## What Must Be Nailed

- **Ring indicator accuracy** - Visual feedback showing viewed/unviewed state correctly and immediately
- **Resume position** - Opening a story starts at the right photo (first unviewed, or first if all viewed)
- **Cross-session persistence** - Viewed state survives logout/login and app restarts
- **Real-time reaction updates** - Counts update immediately as you tap, no need to reopen
- **Reaction reordering** - Emojis sort by highest count (left to right) after a couple seconds

All equally critical — it's all core story viewing UX that worked before 15.3.

</essential>

<boundaries>
## What's Out of Scope

- No UI changes to story cards — just fix the viewed state logic
- No new features (view counts, timestamps, etc.) — pure regression fix
- No redesigning anything — only restore what was working before
- This is entirely about undoing regressions from the 15.3 navigation architecture changes

</boundaries>

<specifics>
## Specific Ideas

No specific requirements — restore exact pre-15.3 behavior. The functionality was working correctly before the PhotoDetailScreen/navigation changes.

</specifics>

<notes>
## Additional Context

Both issues (story viewed state and reactions) are regressions from Phase 15.3's navigation architecture changes. The PhotoDetailScreen conversion and context-based approach likely broke the callback/state propagation that was working with the previous Modal-based implementation.

Key behaviors to restore:

1. Story ring updates immediately when closing viewer
2. Story opens to first unviewed photo (or first if all viewed)
3. Viewed state persists to database and survives sessions
4. Reaction taps update count in real-time (multiple taps = multiple increments)
5. Reaction emojis reorder by count after brief delay

</notes>

---

_Phase: 15.4-story-viewed-state-fix_
_Context gathered: 2026-02-02_
