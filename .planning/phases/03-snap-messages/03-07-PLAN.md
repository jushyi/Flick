---
phase: 03-snap-messages
plan: 07
type: execute
wave: 1
depends_on: []
files_modified:
  - src/styles/CameraScreen.styles.js
  - src/screens/CameraScreen.js
  - src/screens/SnapPreviewScreen.js
  - src/components/ConversationRow.js
autonomous: true
requirements: [SNAP-01, SNAP-02]
gap_closure: true

must_haves:
  truths:
    - 'Snap camera footer buttons align correctly on both iOS and Android using dynamic safe area insets'
    - 'Snap camera shows recipient name header (To: FriendName) so user knows who they are sending to'
    - 'SnapPreviewScreen Polaroid frame looks realistically thick on mobile screens'
    - 'SnapPreviewScreen caption input is fully visible above keyboard on both platforms'
    - 'Conversation row unread badge does not displace the snap camera shortcut button'
  artifacts:
    - path: 'src/styles/CameraScreen.styles.js'
      provides: 'Dynamic safe area paddingBottom for footerControlsSnap'
      contains: 'insets.bottom'
    - path: 'src/screens/CameraScreen.js'
      provides: 'Recipient name header in snap mode'
      contains: 'friendDisplayName'
    - path: 'src/screens/SnapPreviewScreen.js'
      provides: 'Thicker Polaroid border and fixed keyboard lift'
      contains: 'POLAROID_BORDER'
    - path: 'src/components/ConversationRow.js'
      provides: 'Absolutely positioned unread badge'
      contains: "position: 'absolute'"
  key_links:
    - from: 'src/screens/CameraScreen.js'
      to: 'src/styles/CameraScreen.styles.js'
      via: 'styles import'
      pattern: "styles\\.footerControlsSnap"
---

<objective>
Fix four layout/cosmetic UAT gaps across snap camera, preview, and conversation list screens.

Purpose: Address UAT Tests 1, 2, 3, and 6 — all are layout or sizing issues that affect visual quality on both platforms but do not change behavior.
Output: Four files updated with targeted style fixes.
</objective>

<execution_context>
@C:/Users/maser/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/maser/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/03-snap-messages/03-UAT.md
@.planning/debug/snap-preview-keyboard-lift.md
@.planning/debug/unread-badge-pushes-snap-button.md
@src/styles/CameraScreen.styles.js
@src/screens/CameraScreen.js
@src/screens/SnapPreviewScreen.js
@src/components/ConversationRow.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix snap camera footer padding and add recipient header</name>
  <files>src/styles/CameraScreen.styles.js, src/screens/CameraScreen.js</files>
  <action>
**CameraScreen.styles.js** — The `footerControlsSnap` style uses hardcoded `paddingBottom: 20` which is too short on iOS (home indicator is ~34px) and too tall on Android (gesture nav varies 0-24px). This style cannot use hooks (it is a static StyleSheet), so remove `paddingBottom` from `footerControlsSnap` entirely. The dynamic padding will be applied inline in CameraScreen.js.

**CameraScreen.js** — Two changes:

1. **Dynamic footer padding**: Import `useSafeAreaInsets` from `react-native-safe-area-context`. Get `insets` at the top of the component. On the `footerControlsSnap` View (line 381), apply inline style that adds `paddingBottom: Math.max(insets.bottom, 16)` (ensures minimum 16px on devices without home indicators). Do NOT change `footerControls` (normal camera mode) — only snap mode needs this fix because snap mode has no tab bar below.

2. **Recipient header**: When `isSnapMode` is true, render a header bar between the camera container and the floating controls. Position it absolutely, below the status bar area: `top: insets.top + 8`. Center-align the text "To: {friendDisplayName || 'Friend'}" using the app's body font (`typography.fontFamily.body`), `fontSize: typography.size.md`, `color: colors.text.primary`. Add a semi-transparent background pill behind the text (`backgroundColor: colors.overlay.dark`, `borderRadius: 16`, `paddingHorizontal: 14`, `paddingVertical: 6`). Place it with `alignSelf: 'center'` and `zIndex: 10`. The `friendDisplayName` is already destructured from `route.params` on line 218.

Add the recipient header styles to the existing `snapStyles` StyleSheet at the bottom of CameraScreen.js (not to the shared styles file).
</action>
<verify>
<automated>cd "C:/Users/maser/Lapse Clone" && npx eslint src/styles/CameraScreen.styles.js src/screens/CameraScreen.js --no-error-on-unmatched-pattern</automated>
<manual>On device: open snap camera from a DM. Footer buttons should align with the bottom edge correctly on both iOS and Android. A "To: FriendName" header should be visible near the top of the screen.</manual>
</verify>
<done>footerControlsSnap uses dynamic safe area bottom inset instead of hardcoded 20px. Snap mode camera shows "To: RecipientName" pill header near the top of the screen.</done>
</task>

<task type="auto">
  <name>Task 2: Thicken Polaroid frame, fix KAV offset, and fix unread badge layout</name>
  <files>src/screens/SnapPreviewScreen.js, src/components/ConversationRow.js</files>
  <action>
**SnapPreviewScreen.js** — Two changes:

1. **Thicker Polaroid border**: Change `POLAROID_BORDER` from `8` to `16` on line 53. This doubles the white border around the photo, making it look more like a real Polaroid. Also increase `POLAROID_STRIP_HEIGHT` from `56` to `64` to match the thicker bottom strip proportionally. No other changes needed — `polaroidWidth`, `photoWidth`, and `captionStrip` styles all derive from these constants.

2. **Fix KeyboardAvoidingView**: The footer (send button area, lines 232-248) sits OUTSIDE and BELOW the KAV, causing KAV to under-compensate by the footer height (~88-106px). Fix by moving the footer INSIDE the KAV. Restructure the layout so the KAV wraps BOTH the Polaroid and the footer:

```
<KeyboardAvoidingView style={{ flex: 1 }} behavior={Platform.select({ ios: 'padding', android: 'padding' })} keyboardVerticalOffset={Platform.select({ ios: insets.top + 56, android: 0 })}>
  <GestureDetector gesture={panGesture}>
    <Animated.View style={[screenStyles.polaroidOuter, animatedStyle]}>
      ... Polaroid frame ...
    </Animated.View>
  </GestureDetector>

  {/* Footer now INSIDE KAV */}
  <View style={[screenStyles.footer, { paddingBottom: Math.max(insets.bottom, 16) + 8 }]}>
    ... send button ...
  </View>
</KeyboardAvoidingView>
```

The `keyboardVerticalOffset` for iOS accounts for the header height (insets.top + ~56px for header). Android uses `behavior='padding'` (not `'height'` which is unreliable) with offset 0. This ensures the entire content (Polaroid + footer) lifts correctly when the keyboard opens.

**ConversationRow.js** — One change:

Change the UnreadBadge from flow layout to absolute positioning so it does not affect the height of `rightColumn`:

1. On `rightColumn` style (line 243): add `position: 'relative'` (explicit for the absolute child) and a fixed `minHeight` to prevent layout shifts. Keep `alignItems: 'flex-end'`.

2. On `unreadBadge` style (line 252): change to absolute positioning. Set `position: 'absolute'`, `top: 22` (below the rightTopRow), `right: 0`. Remove `marginTop: 4` (no longer needed with absolute positioning).

This makes the badge overlay without participating in flow layout, so rightColumn's height stays constant and the snap button never shifts.
</action>
<verify>
<automated>cd "C:/Users/maser/Lapse Clone" && npx eslint src/screens/SnapPreviewScreen.js src/components/ConversationRow.js --no-error-on-unmatched-pattern</automated>
<manual>SnapPreviewScreen: Polaroid frame should have a noticeably thicker white border. When tapping the caption input, the entire Polaroid + send button should lift above the keyboard on both platforms. ConversationRow: unread badges should not push the snap camera button up or down.</manual>
</verify>
<done>Polaroid border is 16px (doubled from 8). KAV correctly lifts both Polaroid and footer above keyboard on iOS and Android. Unread badge uses absolute positioning and does not affect snap button position.</done>
</task>

</tasks>

<verification>
- `npx eslint src/styles/CameraScreen.styles.js src/screens/CameraScreen.js src/screens/SnapPreviewScreen.js src/components/ConversationRow.js --no-error-on-unmatched-pattern` passes
- No `console.log` statements introduced
- All four UAT gaps (Tests 1, 2, 3, 6) addressed
</verification>

<success_criteria>

- Snap camera footer buttons are platform-correct using dynamic safe area insets
- "To: RecipientName" header visible in snap camera mode
- Polaroid frame border is 16px on both preview and viewer
- Caption keyboard lift works correctly on both iOS and Android
- Unread badge does not displace conversation row snap button
  </success_criteria>

<output>
After completion, create `.planning/phases/03-snap-messages/03-07-SUMMARY.md`
</output>
