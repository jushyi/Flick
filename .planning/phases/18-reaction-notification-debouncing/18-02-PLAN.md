---
phase: 18-reaction-notification-debouncing
plan: 02
type: execute
---

<objective>
Build the notifications feed UI with heart button on FeedScreen header and NotificationsScreen with vertical notification list.

Purpose: Give users a place to view aggregated reaction notifications in-app, Instagram-style.
Output: NotificationsScreen component, heart button with red dot indicator, navigation integration.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/18-reaction-notification-debouncing/18-CONTEXT.md
@.planning/phases/18-reaction-notification-debouncing/18-01-SUMMARY.md
@src/screens/FeedScreen.js
@src/navigation/AppNavigator.js

**From 18-CONTEXT.md:**
- Heart button on feed page opens notifications feed (like Instagram)
- Instagram-style vertical list: profile photo, notification text, timestamp
- Small red dot badge on heart button for new notifications (not a count)
- No read/unread tracking for this phase
- Tapping notification doesn't navigate to photo (out of scope)

**Firestore notifications collection structure (from 18-01):**
```javascript
{
  recipientId: string,
  type: 'reaction',
  senderId: string,
  senderName: string,
  senderProfilePhotoURL: string,
  photoId: string,
  reactions: { [emoji]: count },
  message: string,
  createdAt: timestamp,
  read: boolean
}
```
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create NotificationsScreen with vertical notification list</name>
  <files>src/screens/NotificationsScreen.js</files>
  <action>
Create a new NotificationsScreen component:

1. Import required dependencies:
   - FlatList, RefreshControl for list
   - Image for profile photos
   - Firestore query utilities

2. Query notifications from Firestore:
   ```javascript
   const notificationsRef = collection(db, 'notifications');
   const q = query(
     notificationsRef,
     where('recipientId', '==', userId),
     orderBy('createdAt', 'desc'),
     limit(50)
   );
   ```

3. NotificationItem component with layout:
   - Left: Profile photo (50x50 rounded circle)
   - Center: Message text (e.g., "Sarah reacted üòÇ√ó2 ‚ù§Ô∏è√ó1 to your photo")
   - Right: Relative timestamp (e.g., "2m", "1h", "3d")

4. Use existing timeUtils.js getTimeAgo for timestamp formatting.

5. Styling to match app aesthetic:
   - White/light gray background (#FAFAFA)
   - Items with subtle separator
   - Pull-to-refresh enabled

6. Empty state: "No notifications yet" with heart icon

IMPORTANT: Keep it simple - just display, no tap actions, no read/unread visual distinction.
  </action>
  <verify>
Import and render NotificationsScreen in isolation. Mock data or query Firestore. Verify list renders correctly with profile photos and formatted messages.
  </verify>
  <done>
- NotificationsScreen.js created
- Queries notifications collection by recipientId
- Renders vertical list with profile photo, message, timestamp
- Empty state handled
- Pull-to-refresh enabled
  </done>
</task>

<task type="auto">
  <name>Task 2: Add heart button to FeedScreen header with red dot indicator</name>
  <files>src/screens/FeedScreen.js</files>
  <action>
Modify FeedScreen header to add heart button:

1. Add navigation import if not present:
   ```javascript
   import { useNavigation } from '@react-navigation/native';
   ```

2. Add state for "has new notifications":
   ```javascript
   const [hasNewNotifications, setHasNewNotifications] = useState(false);
   ```

3. Add Firestore listener to check for unread notifications:
   ```javascript
   useEffect(() => {
     if (!user?.uid) return;

     const q = query(
       collection(db, 'notifications'),
       where('recipientId', '==', user.uid),
       where('read', '==', false),
       limit(1)
     );

     const unsubscribe = onSnapshot(q, (snapshot) => {
       setHasNewNotifications(!snapshot.empty);
     });

     return () => unsubscribe();
   }, [user?.uid]);
   ```

4. Add heart button to header (right side of "Lapse" title):
   ```jsx
   <View style={styles.header}>
     <Text style={styles.headerTitle}>Lapse</Text>
     <TouchableOpacity
       onPress={() => navigation.navigate('Notifications')}
       style={styles.notificationButton}
     >
       <Ionicons name="heart-outline" size={24} color="#000000" />
       {hasNewNotifications && (
         <View style={styles.notificationDot} />
       )}
     </TouchableOpacity>
   </View>
   ```

5. Add styles for notification button and red dot:
   ```javascript
   notificationButton: {
     padding: 8,
     position: 'relative',
   },
   notificationDot: {
     position: 'absolute',
     top: 6,
     right: 6,
     width: 8,
     height: 8,
     borderRadius: 4,
     backgroundColor: '#FF3B30', // iOS red
   },
   ```

6. Import Ionicons (or use existing icon library in project):
   ```javascript
   import { Ionicons } from '@expo/vector-icons';
   ```

IMPORTANT: The red dot shows presence of unread notifications (read: false), not a count. Simple boolean indicator.
  </action>
  <verify>
Run app, navigate to Feed. Heart button visible in header. If notifications exist with read: false, red dot appears. Tapping heart navigates to Notifications screen.
  </verify>
  <done>
- Heart button added to FeedScreen header
- Red dot indicator shows when unread notifications exist
- Tapping navigates to NotificationsScreen
  </done>
</task>

<task type="auto">
  <name>Task 3: Add NotificationsScreen to navigation</name>
  <files>src/navigation/AppNavigator.js, src/screens/index.js</files>
  <action>
1. Export NotificationsScreen from screens index:
   ```javascript
   export { default as NotificationsScreen } from './NotificationsScreen';
   ```

2. Add NotificationsScreen to the navigation stack:
   - If using MainStackNavigator pattern, add as a modal/screen:
   ```jsx
   <Stack.Screen
     name="Notifications"
     component={NotificationsScreen}
     options={{
       headerTitle: 'Notifications',
       headerBackTitle: 'Feed',
     }}
   />
   ```

3. Verify navigation works from FeedScreen heart button.

IMPORTANT: Match existing navigation patterns in the codebase. Check how other screens like FriendRequests are added for consistency.
  </action>
  <verify>
Tap heart button on FeedScreen. NotificationsScreen opens. Back button returns to FeedScreen. No navigation errors in console.
  </verify>
  <done>
- NotificationsScreen exported from screens/index.js
- NotificationsScreen added to navigation stack
- Navigation from FeedScreen works correctly
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] NotificationsScreen displays list of reaction notifications
- [ ] Profile photos, message text, and timestamps render correctly
- [ ] Heart button visible in FeedScreen header
- [ ] Red dot appears when unread notifications exist
- [ ] Tapping heart navigates to NotificationsScreen
- [ ] Pull-to-refresh works on NotificationsScreen
- [ ] Empty state displays when no notifications
- [ ] No TypeScript/ESLint errors
</verification>

<success_criteria>
- NotificationsScreen fully functional
- Heart button with red dot indicator working
- Navigation integrated correctly
- Phase 18 complete - reaction notification debouncing end-to-end
</success_criteria>

<output>
After completion, create `.planning/phases/18-reaction-notification-debouncing/18-02-SUMMARY.md`:

# Phase 18 Plan 02: Frontend - Notifications Feed UI Summary

**[Substantive one-liner]**

## Accomplishments

- [Key outcome 1]
- [Key outcome 2]

## Files Created/Modified

- `src/screens/NotificationsScreen.js` - New notifications feed screen
- `src/screens/FeedScreen.js` - Added heart button with red dot
- `src/navigation/AppNavigator.js` - Added Notifications route
- `src/screens/index.js` - Exported NotificationsScreen

## Decisions Made

[Any implementation choices]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Step

Phase 18 complete, ready for next phase (18.1: Batched Darkroom Triage with Undo)
</output>
